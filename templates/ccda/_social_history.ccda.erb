<component>
  <!--Social History - CCDA-->
  <section>
    <templateId root="2.16.840.1.113883.10.20.22.2.17"/>
    <templateId root="2.16.840.1.113883.3.88.11.83.126" assigningAuthorityName="HITSP/C83"/>
    <templateId root="2.16.840.1.113883.10.20.1.15" assigningAuthorityName="CCD"/>
    <templateId root="1.3.6.1.4.1.19376.1.5.3.1.3.16" assigningAuthorityName="IHE PCC"/>
    <!-- Social history section template -->
    <code code="29762-2" codeSystem="2.16.840.1.113883.6.1"/>
    <title>Social History</title>
    <%== render :partial => 'narrative_block', :locals => {:entries => entries, :section => 'social_history'} %>
    <% entries.each_with_index do |entry, i| -%>
    <entry typeCode="DRIV">
      <observation classCode="OBS" moodCode="EVN">
        <templateId root="2.16.840.1.113883.10.20.22.4.38"/>
        <templateId root="2.16.840.1.113883.3.88.11.83.19" assigningAuthorityName="HITSP C83"/>
        <templateId root="2.16.840.1.113883.10.20.1.33" assigningAuthorityName="CCD"/>
        <templateId root="1.3.6.1.4.1.19376.1.5.3.1.4.13.4" assigningAuthorityName="IHE PCC"/>
        <!-- Social history observation template -->
        <id root="<%= UUID.generate %>"/>
        <%== code_display(entry, {:preferred_code_sets => ['SNOMED-CT']}) %>
        <statusCode code="completed"/>
        <effectiveTime <%= value_or_null_flavor(entry.as_point_in_time) %>/>
      </observation>l
    </entry>
    <% end -%>
  </section>
</component>